<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:Multi_Saves_Backup_Tool.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="Multi_Saves_Backup_Tool.Views.AddGameOverlay"
             x:CompileBindings="True"
             x:DataType="vm:AddGameOverlayViewModel">
    <Grid>
        <Rectangle Fill="Black" Opacity="0.5"/>
        
        <Border Background="#272727"
                CornerRadius="8"
                Width="600"
                Height="600"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                BoxShadow="0 4 8 0 #40000000">
            <Grid Margin="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Add New Game"
                           FontSize="24"
                           FontWeight="Bold"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,20"/>

                <ScrollViewer Grid.Row="1" 
                              VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="10">
                        <StackPanel>
                            <TextBox Watermark="Game Name"
                                    Text="{Binding GameName}"/>
                            <TextBlock Text="{Binding GameNameError}"
                                     Foreground="Red"
                                     IsVisible="{Binding GameNameError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                     FontSize="12"
                                     Margin="0,2,0,0"/>
                        </StackPanel>
                        
                        <StackPanel>
                            <Grid ColumnDefinitions="*, Auto">
                                <TextBox Watermark="Game Executable (e.g., NMS.exe)"
                                        Text="{Binding GameExe}"/>
                                <Button Content="Browse"
                                        Margin="5,0,0,0"
                                        Grid.Column="1"
                                        Command="{Binding BrowseGameExeCommand}"
                                        CommandParameter="{Binding $parent[TopLevel].StorageProvider}"/>
                            </Grid>
                            <TextBlock Text="{Binding GameExeError}"
                                     Foreground="Red"
                                     IsVisible="{Binding GameExeError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                     FontSize="12"
                                     Margin="0,2,0,0"/>
                        </StackPanel>
                        
                        <Grid ColumnDefinitions="*, Auto">
                            <TextBox Watermark="Alternative Executable (optional)"
                                    Text="{Binding GameExeAlt}"/>
                            <Button Content="Browse"
                                    Margin="5,0,0,0"
                                    Grid.Column="1"
                                    Command="{Binding BrowseGameExeAltCommand}"
                                    CommandParameter="{Binding $parent[TopLevel].StorageProvider}"/>
                        </Grid>
                        
                        <StackPanel>
                            <Grid ColumnDefinitions="*, Auto">
                                <TextBox Watermark="Save Files Location"
                                        Text="{Binding SaveLocation}"/>
                                <Button Content="Browse"
                                        Margin="5,0,0,0"
                                        Grid.Column="1"
                                        Command="{Binding BrowseSaveLocationCommand}"
                                        CommandParameter="{Binding $parent[TopLevel].StorageProvider}"/>
                            </Grid>
                            <TextBlock Text="{Binding SaveLocationError}"
                                     Foreground="Red"
                                     IsVisible="{Binding SaveLocationError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                     FontSize="12"
                                     Margin="0,2,0,0"/>
                        </StackPanel>

                        <Grid ColumnDefinitions="*, Auto">
                            <TextBox Watermark="Mods Folder (optional)"
                                    Text="{Binding ModPath}"/>
                            <Button Content="Browse"
                                    Margin="5,0,0,0"
                                    Grid.Column="1"
                                    Command="{Binding BrowseModPathCommand}"
                                    CommandParameter="{Binding $parent[TopLevel].StorageProvider}"/>
                        </Grid>

                        <Grid ColumnDefinitions="*, Auto">
                            <TextBox Watermark="Additional Backup Path (optional)"
                                    Text="{Binding AddPath}"/>
                            <Button Content="Browse"
                                    Margin="5,0,0,0"
                                    Grid.Column="1"
                                    Command="{Binding BrowseAddPathCommand}"
                                    CommandParameter="{Binding $parent[TopLevel].StorageProvider}"/>
                        </Grid>

                        <StackPanel>
                            <TextBlock Text="Backup Settings:"
                                       FontWeight="Bold"
                                       Margin="0,10,0,5"/>
                                       
                            <Grid ColumnDefinitions="*, Auto">
                                <TextBlock Text="Days to keep backups (0 - keep all)"
                                           VerticalAlignment="Center"/>
                                <NumericUpDown Value="{Binding DaysForKeep}"
                                               Minimum="0"
                                               Grid.Column="1"
                                               Width="100"/>
                            </Grid>

                            <ComboBox SelectedIndex="{Binding OldFilesStatus}"
                                      Margin="0,5,0,0">
                                <ComboBoxItem>Keep all files</ComboBoxItem>
                                <ComboBoxItem>Move to archive</ComboBoxItem>
                                <ComboBoxItem>Delete permanently</ComboBoxItem>
                            </ComboBox>

                            <CheckBox Content="Include timestamp in archive name"
                                      IsChecked="{Binding IncludeTimestamp}"
                                      Margin="0,5,0,0"/>

                            <ComboBox SelectedIndex="{Binding BackupMode}"
                                      Margin="0,5,0,0">
                                <ComboBoxItem>Backup all files</ComboBoxItem>
                                <ComboBoxItem>Backup changed files only</ComboBoxItem>
                            </ComboBox>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>

                <StackPanel Grid.Row="2"
                          Orientation="Horizontal"
                          HorizontalAlignment="Right"
                          Spacing="10"
                          Margin="0,20,0,0">
                    <Button Content="Add"
                            Command="{Binding AddCommand}"/>
                    <Button Content="Cancel"
                            Click="Close"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>

